# Data Viewing Tools

This directory contains tools for visualizing and analyzing detector hit data from ROOT files. These tools are designed to help researchers and scientists analyze particle detector data efficiently.

## Project Structure
```
.
├── Occupancy.py              # Main script for analyzing detector occupancy
├── plot.py                   # Script for detailed hit pattern visualization
├── process_hits_data.py      # Script for analyzing accumulated hit data
└── QTracker_Station_Occupancies/  # Output directory for generated files
    ├── group_plots/         # Individual detector group plots
    ├── overall_occupancy_with_separators.png
    ├── overall_occupancy_no_separators.png
    ├── file_hits_data.json
    ├── total_hits_data.json
    └── hit_heatmap.png
```

## Occupancy.py

`Occupancy.py` is a tool for analyzing and visualizing detector occupancy patterns across multiple ROOT files. It processes detector hit data and generates both individual and combined occupancy plots.

### Features
- Processes multiple ROOT files containing detector hit data
- Generates occupancy plots for individual detector groups
- Creates overall occupancy plots with and without group separators
- Saves accumulated hit data for further analysis
- Supports processing a subset of files for debugging
- Progress bar for tracking file processing status
- Configurable output directory and file patterns

### Usage
```bash
# Process all ROOT files in the current directory
python Occupancy.py

# Process ROOT files from a specific directory
python Occupancy.py --directory /path/to/root/files

# Example with specific file pattern
python Occupancy.py --directory /path/to/root/files --pattern "*.root"
```

#### Arguments
- `--directory`: Path to the directory containing ROOT files (default: current directory)
- `--pattern`: File pattern to match ROOT files (default: "*.root")
- `--output`: Output directory for generated files (default: "QTracker_Station_Occupancies")

### Output
The script generates the following outputs in the specified output directory:
1. Individual detector group plots in separate subdirectories
2. Overall occupancy plots:
   - `overall_occupancy_with_separators.png`
   - `overall_occupancy_no_separators.png`
3. Accumulated hit data:
   - `file_hits_data.json`: Hit counts per file
   - `total_hits_data.json`: Total accumulated hits across all files

### Data Analysis
The saved JSON files can be loaded for further analysis:
```python
import json

# Load total hits
with open('QTracker_Station_Occupancies/total_hits_data.json', 'r') as f:
    total_hits = json.load(f)

# Load per-file hits
with open('QTracker_Station_Occupancies/file_hits_data.json', 'r') as f:
    file_hits = json.load(f)

# Example: Print total hits for each detector
for detector_id, hits in total_hits.items():
    print(f"Detector {detector_id}: {sum(hits)} hits")
```

## plot.py

`plot.py` is a tool for creating detailed plots of detector hit patterns. It provides visualization capabilities for analyzing hit distributions and patterns in the detector data.

### Features
- Generates detailed hit pattern visualizations
- Supports custom plot configurations
- Provides options for different visualization styles
- Interactive plot viewing
- Customizable color schemes and plot layouts

### Usage
```bash
# Basic usage
python plot.py

# With specific input file
python plot.py --input data.root

# With custom output directory
python plot.py --output plots/
```

### Output
The script generates plot files in the specified output directory, showing detailed hit patterns and distributions.

## process_hits_data.py

`process_hits_data.py` is a tool for analyzing and visualizing the accumulated hit data generated by `Occupancy.py`. It processes the JSON data file and creates a 2D heatmap visualization of detector hits.

### Features
- Loads hit data from the JSON file generated by `Occupancy.py`
- Creates a 2D heatmap visualization of detector hits
- Formats data for statistical analysis
- Provides clear visualization of hit patterns across all detectors
- Customizable color schemes and plot parameters
- Support for different output formats

### Usage
```bash
# Basic usage
python process_hits_data.py

# With specific input file
python process_hits_data.py --input custom_hits_data.json

# With custom output file
python process_hits_data.py --output custom_heatmap.png
```

### Input
The script expects a file named `total_hits_data.json` in the `QTracker_Station_Occupancies` directory. This file is automatically generated by `Occupancy.py` and contains:
- A 2D array of hit counts
- Maximum detector and element IDs
- All values are stored as native Python integers

### Output
The script generates:
1. A 2D heatmap visualization saved as `hit_heatmap.png`
2. The heatmap shows:
   - Detector IDs on the x-axis
   - Element IDs on the y-axis
   - Hit counts represented by color intensity
   - A colorbar indicating the scale of hits
   - Clear labels and title

### Example Workflow
1. First, run `Occupancy.py` to process your ROOT files:
   ```bash
   python Occupancy.py --directory /path/to/root/files
   ```
2. This will generate `total_hits_data.json` in the `QTracker_Station_Occupancies` directory
3. Then run `process_hits_data.py` to create the heatmap:
   ```bash
   python process_hits_data.py
   ```
4. The resulting heatmap will be saved as `hit_heatmap.png` in the same directory

## Requirements
- Python 3.6 or higher
- Required Python packages:
  - numpy (>= 1.19.0)
  - uproot (>= 4.0.0)
  - matplotlib (>= 3.3.0)
  - tqdm (>= 4.50.0)
  - json (built-in)

## Installation
```bash
# Create a virtual environment (recommended)
python -m venv venv
source venv/bin/activate  # On Windows: venv\Scripts\activate

# Install required packages
pip install numpy uproot matplotlib tqdm

# Verify installation
python -c "import numpy, uproot, matplotlib, tqdm; print('All packages installed successfully!')"
```

## Notes
- For debugging purposes, you can limit the number of files processed by modifying the `max_files` parameter in `Occupancy.py`
- The scripts expect ROOT files to be in the standard format with detector hit data
- Make sure you have sufficient disk space for the output files, especially when processing large datasets
- The output directory structure is automatically created if it doesn't exist
- Progress bars are shown for long-running operations
- All plots are saved in high resolution (300 DPI) by default

## Additional Information

The data that we will be using for these scripts is located in [this Google Drive](https://drive.google.com/drive/folders/1w2mU1nDPTJMfll2MEAYWxTa-N9PvQuhs?usp=share_link). This data is in the SRAW ROOT structure format and is from real experimental data. Please download the entire directory and call the path to that directory when using files such as `Occupancy.py` or `plot.py`. Feel free to edit either of these scripts as needed.

## Contributing
Feel free to submit issues, fork the repository, and create pull requests for any improvements. Please ensure your code follows the existing style and includes appropriate documentation.

## License
This project is open source and available under the MIT License.